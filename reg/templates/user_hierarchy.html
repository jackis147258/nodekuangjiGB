<!DOCTYPE html>
<html>
<head>
    <title>用户层级</title>
    <style>
        /* 基础样式 */
        .tree { margin-left: 20px; }
        .node { cursor: pointer; }
        .child-node { display: none; margin-left: 20px; }
        /* 颜色渐变 */
        .level-0 { color: #007bff; }
        .level-1 { color: #006fde; }
        .level-2 { color: #0062c1; }
        .level-3 { color: #0056a4; }
        /* 更多颜色样式 */
        .indicator { font-weight: bold; margin-right: 5px; }
    </style>
    <script>
        function toggleChildren(node) {
            var children = node.parentNode.querySelector(".child-node");
            if (children.style.display === "none") {
                children.style.display = "block";
                node.querySelector('.indicator').textContent = '-';
            } else {
                children.style.display = "none";
                node.querySelector('.indicator').textContent = '+';
            }
        }

        function expandAll() {
            var nodes = document.querySelectorAll(".child-node");
            nodes.forEach(function(node) {
                node.style.display = "block";
                if (node.parentNode.querySelector('.indicator')) {
                    node.parentNode.querySelector('.indicator').textContent = '-';
                }
            });
        }

        function collapseAll() {
            var nodes = document.querySelectorAll(".child-node");
            nodes.forEach(function(node) {
                node.style.display = "none";
                if (node.parentNode.querySelector('.indicator')) {
                    node.parentNode.querySelector('.indicator').textContent = '+';
                }
            });
        }
    </script>
</head>
<body>
    <div>
        <button onclick="expandAll()">全部展开</button>
        <button onclick="collapseAll()">全部收缩</button>
        <span>全部用户数：{{ root_nodes|length }}</span>
        <span>共有层级数：{{ max_level }}</span>
    </div>
    <div class="tree">
        {% for node in root_nodes %}
            <div class="node level-{{ node.level }}" onclick="toggleChildren(this);">
                <span class="indicator">{% if node.get_children %}+{% else %}&nbsp;{% endif %}</span>
                {{ node.username }}
            </div>
            {% if node.get_children %}
                <div class="child-node">
                    {% include "user_hierarchy.html" with root_nodes=node.get_children %}
                </div>
            {% endif %}
        {% endfor %}
    </div>
</body>
</html>
